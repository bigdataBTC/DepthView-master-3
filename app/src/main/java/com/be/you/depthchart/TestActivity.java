package com.be.you.depthchart;

import android.os.Handler;
import android.support.v7.app.AppCompatActivity;
import android.os.Bundle;
import android.widget.LinearLayout;

import com.be.you.depthchart.api.DepthData;
import com.be.you.depthchart.depthchart.DepthDataObject;
import com.be.you.depthchart.depthchart.MergeDepthView;

import org.json.JSONArray;
import org.json.JSONException;
import org.json.JSONObject;

import java.util.ArrayList;
import java.util.List;
import java.util.Random;

public class TestActivity extends AppCompatActivity {
    private String jsonData = "{\"status\":\"ok\",\"ch\":\"market.btcusdt.depth.step0\",\"ts\":1529041576307,\"tick\":{\"bids\":[[6564.720000000000000000,0.314100000000000000],[6564.710000000000000000,1.500000000000000000],[6564.510000000000000000,0.321100000000000000],[6564.460000000000000000,0.664200000000000000],[6564.450000000000000000,0.327000000000000000],[6564.400000000000000000,0.691200000000000000],[6564.340000000000000000,0.067300000000000000],[6564.280000000000000000,0.010000000000000000],[6564.260000000000000000,0.010000000000000000],[6563.620000000000000000,1.500000000000000000],[6563.570000000000000000,2.252500000000000000],[6563.520000000000000000,1.500000000000000000],[6563.380000000000000000,0.040000000000000000],[6562.560000000000000000,0.063000000000000000],[6562.550000000000000000,0.322600000000000000],[6562.500000000000000000,0.457200000000000000],[6562.450000000000000000,1.421900000000000000],[6561.810000000000000000,0.010000000000000000],[6561.640000000000000000,0.028100000000000000],[6561.370000000000000000,0.050000000000000000],[6561.100000000000000000,0.367000000000000000],[6560.250000000000000000,0.075000000000000000],[6560.240000000000000000,0.500000000000000000],[6559.420000000000000000,0.026500000000000000],[6558.750000000000000000,1.500000000000000000],[6558.100000000000000000,0.350000000000000000],[6558.000000000000000000,0.200000000000000000],[6557.860000000000000000,0.040000000000000000],[6557.760000000000000000,1.000000000000000000],[6557.750000000000000000,0.002500000000000000],[6557.740000000000000000,1.000000000000000000],[6556.530000000000000000,0.010000000000000000],[6556.500000000000000000,0.200200000000000000],[6556.160000000000000000,0.398400000000000000],[6555.250000000000000000,0.002500000000000000],[6554.800000000000000000,0.010000000000000000],[6554.590000000000000000,2.288400000000000000],[6554.340000000000000000,0.034000000000000000],[6554.250000000000000000,0.166600000000000000],[6554.040000000000000000,0.010000000000000000],[6554.000000000000000000,0.002500000000000000],[6553.500000000000000000,0.037700000000000000],[6553.160000000000000000,0.020000000000000000],[6552.920000000000000000,2.289000000000000000],[6552.830000000000000000,0.020000000000000000],[6552.800000000000000000,0.033200000000000000],[6552.750000000000000000,0.002500000000000000],[6552.250000000000000000,0.166600000000000000],[6552.100000000000000000,0.010000000000000000],[6551.940000000000000000,0.019100000000000000],[6551.230000000000000000,0.149000000000000000],[6551.220000000000000000,1.000000000000000000],[6550.880000000000000000,1.337200000000000000],[6550.720000000000000000,0.088600000000000000],[6550.250000000000000000,0.169300000000000000],[6550.080000000000000000,0.460000000000000000],[6550.000000000000000000,0.200000000000000000],[6549.500000000000000000,1.500000000000000000],[6549.330000000000000000,0.038600000000000000],[6548.920000000000000000,0.038500000000000000],[6548.700000000000000000,0.026500000000000000],[6548.680000000000000000,0.020000000000000000],[6548.250000000000000000,0.166900000000000000],[6548.090000000000000000,0.027100000000000000],[6548.000000000000000000,0.004600000000000000],[6547.750000000000000000,0.002500000000000000],[6547.500000000000000000,0.010000000000000000],[6546.500000000000000000,0.002500000000000000],[6546.440000000000000000,0.011400000000000000],[6546.250000000000000000,0.166900000000000000],[6546.120000000000000000,0.982400000000000000],[6545.920000000000000000,0.065400000000000000],[6545.870000000000000000,4.552700000000000000],[6545.830000000000000000,0.887200000000000000],[6545.250000000000000000,0.002500000000000000],[6544.290000000000000000,0.026500000000000000],[6544.250000000000000000,0.167000000000000000],[6544.000000000000000000,0.002500000000000000],[6542.750000000000000000,0.002500000000000000],[6542.250000000000000000,0.167100000000000000],[6541.910000000000000000,0.577800000000000000],[6541.500000000000000000,0.002500000000000000],[6540.260000000000000000,0.132000000000000000],[6540.250000000000000000,0.169600000000000000],[6539.120000000000000000,0.026500000000000000],[6539.000000000000000000,0.002500000000000000],[6538.580000000000000000,0.050700000000000000],[6538.250000000000000000,0.167100000000000000],[6537.750000000000000000,0.002500000000000000],[6536.500000000000000000,0.002500000000000000],[6535.250000000000000000,0.002500000000000000],[6534.520000000000000000,0.040000000000000000],[6534.000000000000000000,0.002500000000000000],[6533.130000000000000000,0.008600000000000000],[6532.750000000000000000,0.002500000000000000],[6532.260000000000000000,0.018100000000000000],[6531.740000000000000000,0.017300000000000000],[6531.500000000000000000,0.002500000000000000],[6530.250000000000000000,0.002500000000000000],[6530.000000000000000000,1.259800000000000000],[6529.000000000000000000,0.002500000000000000],[6528.000000000000000000,0.050000000000000000],[6527.750000000000000000,0.002500000000000000],[6527.710000000000000000,0.530200000000000000],[6526.700000000000000000,0.010000000000000000],[6526.500000000000000000,0.002500000000000000],[6526.220000000000000000,0.803300000000000000],[6525.910000000000000000,0.006000000000000000],[6525.250000000000000000,0.002500000000000000],[6525.090000000000000000,0.022900000000000000],[6525.000000000000000000,0.675700000000000000],[6524.990000000000000000,0.022900000000000000],[6524.400000000000000000,0.030400000000000000],[6524.000000000000000000,0.002500000000000000],[6523.700000000000000000,0.032300000000000000],[6521.500000000000000000,0.002500000000000000],[6521.000000000000000000,0.008600000000000000],[6520.000000000000000000,0.300000000000000000],[6519.000000000000000000,0.002500000000000000],[6518.880000000000000000,0.500000000000000000],[6517.750000000000000000,0.002500000000000000],[6516.690000000000000000,19.496000000000000000],[6515.000000000000000000,0.359900000000000000],[6514.000000000000000000,0.002500000000000000],[6513.930000000000000000,0.027000000000000000],[6512.750000000000000000,0.002500000000000000],[6511.740000000000000000,2.313000000000000000],[6511.500000000000000000,0.002500000000000000],[6510.550000000000000000,0.028800000000000000],[6510.250000000000000000,0.002500000000000000],[6509.380000000000000000,5.301800000000000000],[6509.000000000000000000,0.099600000000000000],[6508.000000000000000000,0.521000000000000000],[6507.750000000000000000,0.002500000000000000],[6506.830000000000000000,0.003100000000000000],[6506.500000000000000000,0.002500000000000000],[6505.350000000000000000,0.001100000000000000],[6505.250000000000000000,0.002500000000000000],[6505.220000000000000000,0.454300000000000000],[6504.220000000000000000,0.006000000000000000],[6504.000000000000000000,0.002500000000000000],[6502.750000000000000000,0.002500000000000000],[6501.600000000000000000,1.017500000000000000],[6501.500000000000000000,0.007500000000000000],[6501.260000000000000000,0.026500000000000000],[6501.180000000000000000,0.040000000000000000],[6501.000000000000000000,0.151000000000000000],[6500.560000000000000000,0.500000000000000000],[6500.400000000000000000,0.040900000000000000],[6500.250000000000000000,0.002500000000000000]],\"asks\":[[6567.170000000000000000,1.417900000000000000],[6567.240000000000000000,0.062500000000000000],[6567.960000000000000000,0.364600000000000000],[6568.060000000000000000,0.358800000000000000],[6568.550000000000000000,0.444900000000000000],[6568.600000000000000000,0.371600000000000000],[6568.650000000000000000,0.453900000000000000],[6568.700000000000000000,0.369500000000000000],[6568.750000000000000000,0.437600000000000000],[6568.850000000000000000,0.149000000000000000],[6569.200000000000000000,0.100000000000000000],[6569.890000000000000000,0.079000000000000000],[6569.900000000000000000,0.369400000000000000],[6570.000000000000000000,5.010000000000000000],[6570.230000000000000000,0.002500000000000000],[6571.480000000000000000,0.094000000000000000],[6572.130000000000000000,0.030000000000000000],[6572.700000000000000000,1.500000000000000000],[6572.710000000000000000,0.030000000000000000],[6572.730000000000000000,0.002500000000000000],[6572.800000000000000000,0.132000000000000000],[6572.980000000000000000,1.500000000000000000],[6573.000000000000000000,0.003600000000000000],[6573.850000000000000000,0.040000000000000000],[6573.880000000000000000,0.500000000000000000],[6574.240000000000000000,1.000000000000000000],[6574.250000000000000000,0.152400000000000000],[6574.740000000000000000,0.398400000000000000],[6574.830000000000000000,0.982400000000000000],[6574.910000000000000000,0.469000000000000000],[6574.930000000000000000,0.500000000000000000],[6575.000000000000000000,1.000000000000000000],[6575.080000000000000000,1.346700000000000000],[6575.100000000000000000,1.139000000000000000],[6575.230000000000000000,0.002500000000000000],[6575.300000000000000000,0.114000000000000000],[6575.310000000000000000,0.040000000000000000],[6575.840000000000000000,0.479900000000000000],[6576.250000000000000000,0.166300000000000000],[6576.480000000000000000,0.002500000000000000],[6576.670000000000000000,0.010000000000000000],[6576.700000000000000000,1.500000000000000000],[6576.760000000000000000,0.632900000000000000],[6577.020000000000000000,0.808800000000000000],[6577.710000000000000000,0.038300000000000000],[6577.730000000000000000,0.002500000000000000],[6578.000000000000000000,0.077000000000000000],[6578.130000000000000000,0.209200000000000000],[6578.150000000000000000,0.088600000000000000],[6578.250000000000000000,0.166100000000000000],[6578.920000000000000000,0.040000000000000000],[6578.980000000000000000,0.002500000000000000],[6580.000000000000000000,0.069600000000000000],[6580.230000000000000000,0.002500000000000000],[6580.250000000000000000,0.166100000000000000],[6580.710000000000000000,0.006000000000000000],[6581.480000000000000000,0.002500000000000000],[6581.490000000000000000,0.282900000000000000],[6581.880000000000000000,0.416100000000000000],[6581.890000000000000000,0.001100000000000000],[6582.250000000000000000,0.166000000000000000],[6582.720000000000000000,1.000000000000000000],[6582.730000000000000000,0.002500000000000000],[6583.700000000000000000,1.500000000000000000],[6583.980000000000000000,0.002500000000000000],[6584.250000000000000000,0.166000000000000000],[6584.750000000000000000,0.001200000000000000],[6584.840000000000000000,0.025100000000000000],[6585.000000000000000000,0.159400000000000000],[6585.210000000000000000,0.810600000000000000],[6585.230000000000000000,0.002500000000000000],[6585.580000000000000000,0.017200000000000000],[6585.730000000000000000,1.002400000000000000],[6586.100000000000000000,0.009500000000000000],[6586.150000000000000000,0.748500000000000000],[6586.230000000000000000,0.156200000000000000],[6586.250000000000000000,0.165900000000000000],[6586.370000000000000000,2.569800000000000000],[6586.410000000000000000,0.482100000000000000],[6586.480000000000000000,0.002500000000000000],[6586.720000000000000000,0.026500000000000000],[6586.840000000000000000,0.784000000000000000],[6587.220000000000000000,1.091400000000000000],[6587.550000000000000000,0.006000000000000000],[6587.580000000000000000,0.530100000000000000],[6587.730000000000000000,0.002500000000000000],[6588.250000000000000000,0.165800000000000000],[6588.980000000000000000,0.002500000000000000],[6589.140000000000000000,0.250700000000000000],[6590.110000000000000000,0.611800000000000000],[6590.230000000000000000,0.002500000000000000],[6590.250000000000000000,0.165600000000000000],[6590.350000000000000000,0.012100000000000000],[6590.880000000000000000,0.362400000000000000],[6590.980000000000000000,0.023900000000000000],[6591.400000000000000000,3.500000000000000000],[6591.450000000000000000,0.208700000000000000],[6591.480000000000000000,0.002500000000000000],[6592.100000000000000000,0.017400000000000000],[6592.730000000000000000,0.002500000000000000],[6593.000000000000000000,0.338100000000000000],[6593.120000000000000000,0.039900000000000000],[6593.360000000000000000,0.308800000000000000],[6593.930000000000000000,0.029000000000000000],[6593.980000000000000000,0.002500000000000000],[6595.000000000000000000,0.898400000000000000],[6595.060000000000000000,1.022300000000000000],[6595.230000000000000000,0.002500000000000000],[6596.480000000000000000,0.002500000000000000],[6597.040000000000000000,0.211700000000000000],[6597.730000000000000000,0.002500000000000000],[6597.770000000000000000,0.001200000000000000],[6598.660000000000000000,0.023700000000000000],[6598.980000000000000000,0.002500000000000000],[6599.000000000000000000,0.159500000000000000],[6599.180000000000000000,0.026500000000000000],[6599.240000000000000000,0.085600000000000000],[6599.810000000000000000,0.009600000000000000],[6599.970000000000000000,0.991400000000000000],[6599.980000000000000000,0.104100000000000000],[6600.000000000000000000,1.663300000000000000],[6600.230000000000000000,0.002500000000000000],[6600.480000000000000000,0.382900000000000000],[6601.480000000000000000,0.002500000000000000],[6601.640000000000000000,0.030000000000000000],[6602.160000000000000000,0.171400000000000000],[6603.750000000000000000,0.004900000000000000],[6603.760000000000000000,0.009800000000000000],[6603.860000000000000000,1.343700000000000000],[6603.970000000000000000,0.094800000000000000],[6603.980000000000000000,0.002500000000000000],[6605.590000000000000000,5.301800000000000000],[6606.480000000000000000,0.002500000000000000],[6606.570000000000000000,0.042200000000000000],[6608.110000000000000000,0.060800000000000000],[6608.980000000000000000,0.002500000000000000],[6610.000000000000000000,0.600000000000000000],[6610.640000000000000000,0.043800000000000000],[6610.790000000000000000,0.001200000000000000],[6611.090000000000000000,0.010000000000000000],[6611.420000000000000000,0.028100000000000000],[6611.480000000000000000,0.002500000000000000],[6612.220000000000000000,0.026500000000000000],[6612.730000000000000000,0.002500000000000000],[6613.220000000000000000,0.003000000000000000],[6613.770000000000000000,0.026500000000000000],[6613.980000000000000000,0.002500000000000000],[6614.190000000000000000,0.040000000000000000],[6615.000000000000000000,0.011100000000000000],[6615.230000000000000000,0.002500000000000000]],\"ts\":1529041576013,\"version\":9494923456}}";


    private LinearLayout lineara;
    private MergeDepthView depthView;

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_test);
        lineara = findViewById(R.id.lineara);
        depthView = new MergeDepthView(this);
        lineara.addView(depthView);
//        depthView.setDepthViewHeigh(800);
        jsonData = DepthData.depthQ;
        newDepth();



//        final Handler handler = new Handler();
//        handler.postDelayed(new Runnable() {
//            @Override
//            public void run() {
//                Random ran = new Random();
//                int Value = ran.nextInt(7) + 1;
//                switch (Value){
//                    case 1:
//                        jsonData = DepthData.depthA;
//                        break;
//                    case 2:
//                        jsonData = DepthData.depthB;
//                        break;
//                    case 3:
//                        jsonData = DepthData.depthC;
//                        break;
//                    case 4:
//                        jsonData = DepthData.depthD;
//                        break;
//                    case 5:
//                        jsonData = DepthData.depthE;
//                        break;
//                    case 6:
//                        jsonData = DepthData.depthF;
//                        break;
//                    case 7:
//                        jsonData = DepthData.depthG;
//                        break;
//                }
//                newDepth();
//                handler.postDelayed(this, 5000);
//            }
//        }, 5000);


    }

    private void newDepth(){
        List<DepthDataObject> listDepthBuy = new ArrayList<>();
        List<DepthDataObject> listDepthSell = new ArrayList<>();
        try {
            JSONObject jsonObject = new JSONObject(jsonData);
            JSONObject jsonTick = jsonObject.optJSONObject("tick");
            JSONArray arrBids = jsonTick.optJSONArray("bids");
            JSONArray arrAsks = jsonTick.optJSONArray("asks");

            for(int i = 0; i < arrBids.length(); i++){
                DepthDataObject obj = new DepthDataObject();
                String price = arrBids.getString(i).replace("[", "").replace("]", "").split(",")[0];
                String volume = arrBids.getString(i).replace("[", "").replace("]", "").split(",")[1];
                obj.setVolume(Float.valueOf(volume));
                obj.setPrice(Float.valueOf(price));
                listDepthBuy.add(obj);
            }


            for(int i = 0; i < arrAsks.length(); i++){
                DepthDataObject obj = new DepthDataObject();
                String price = arrAsks.getString(i).replace("[", "").replace("]", "").split(",")[0];
                String volume = arrAsks.getString(i).replace("[", "").replace("]", "").split(",")[1];
                obj.setVolume(Float.valueOf(volume));
                obj.setPrice(Float.valueOf(price));
                listDepthSell.add(obj);
            }
            depthView.setMdata(listDepthBuy, listDepthSell);
            depthView.setDepthBg("#ffffff");
            depthView.setYaxisTextSize(20);
            depthView.setXaxisTextSize(20);
//            depthView.setGridspace_width(20);
        } catch (JSONException e) {
            e.printStackTrace();
        }

    }



}
